<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:Class="VPortal.ProxyClient.UI.Windows.Pages.RegistrationPage"
             xmlns:ex="clr-namespace:VPortal.ProxyClient.UI.Windows.Views.ExceptionHandling"
             xmlns:local="clr-namespace:VPortal.ProxyClient.UI.Windows"
             Shell.NavBarIsVisible="False"
             Title="Registration">
    <ContentPage.Behaviors>
        <toolkit:EventToCommandBehavior EventName="Loaded"
                                        Command="{Binding Init}" />
    </ContentPage.Behaviors>
    <ContentPage.Resources>
        <Style x:Key="RegistrationStageLabel" TargetType="Label">
            <Style.Triggers>
                <DataTrigger TargetType="Label" Binding="{Binding RegistrationErrorOccured}" Value="True">
                    <Setter Property="TextColor" Value="{StaticResource Error}"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </ContentPage.Resources>
    
    <Grid
            VerticalOptions="FillAndExpand" 
            HorizontalOptions="FillAndExpand">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="1*"/>
            <ColumnDefinition Width="1.4*"/>
            <ColumnDefinition Width="1*"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="30*"/>
            <RowDefinition Height="5*"/>
            <RowDefinition Height="10*"/>
            <RowDefinition Height="10*"/>
            <RowDefinition Height="30*"/>
            <RowDefinition Height="15*"/>
        </Grid.RowDefinitions>

        <VerticalStackLayout 
                Padding="10" Grid.Column="1" Grid.Row="0" 
                VerticalOptions="End" 
                HorizontalOptions="Center">
            <Label
                    class="SectionTitle"
                    HorizontalTextAlignment="Center"
                    Text="CLIENT REGISTRATION"/>
        </VerticalStackLayout>

        <Entry 
                Grid.Column="1" Grid.Row="2"
                Text="{Binding RegistrationKey, Mode=TwoWay}"
                IsVisible="{Binding ShowRegistrationKeyInput}"
                Placeholder="Please, paste the registration key"/>

        <VerticalStackLayout 
                Padding="10" Grid.Column="1" Grid.Row="3" 
                VerticalOptions="Center" 
                HorizontalOptions="Center">
            <HorizontalStackLayout
                VerticalOptions="Center" 
                HorizontalOptions="Center">
                <Button
                    Style="{StaticResource OutlinedButton}"
                    IsEnabled="{Binding RegistrationNotInProcess}"
                    Margin="0,0,15,0"
                    Command="{Binding GoToMain}"
                    Text="Cancel"/>
                <Button
                    IsEnabled="{Binding RegistrationNotInProcess}"
                    Command="{Binding RegisterProxy}"
                    Text="Register"/>
            </HorizontalStackLayout>
        </VerticalStackLayout>

        <HorizontalStackLayout
                Padding="10" Grid.Column="1" Grid.Row="5" 
                Spacing="10"
                HorizontalOptions="Center"
                VerticalOptions="Center">
            <ActivityIndicator 
                VerticalOptions="Center"
                IsVisible="{Binding RegistrationInProcess}"
                IsRunning="{Binding RegistrationInProcess}" />
            <Label
                Style="{StaticResource RegistrationStageLabel}"
                VerticalOptions="Center"
                Text="{Binding CurrentRegistrationStage}"/>
            <ex:ErrorViewer Command="{Binding RegisterProxy}"/>
        </HorizontalStackLayout>
    </Grid>
</ContentPage>