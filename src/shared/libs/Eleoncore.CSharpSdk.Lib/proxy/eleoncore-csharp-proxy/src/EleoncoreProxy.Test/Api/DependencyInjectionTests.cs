/*
 * Eleoncore API
 *
 * No description provided (generated by Openapi Generator https://github.com/openapitools/openapi-generator)
 *
 * The version of the OpenAPI document: v1
 * Generated by: https://github.com/openapitools/openapi-generator.git
 */

using System;
using Microsoft.Extensions.Hosting;
using Microsoft.Extensions.DependencyInjection;
using System.Collections.Generic;
using System.Security.Cryptography;
using EleoncoreProxy.Client;
using EleoncoreProxy.Api;
using EleoncoreProxy.Extensions;
using Xunit;

namespace EleoncoreProxy.Test.Api
{
    /// <summary>
    ///  Tests the dependency injection.
    /// </summary>
    public class DependencyInjectionTest
    {
        private readonly IHost _hostUsingConfigureWithoutAClient =
            Host.CreateDefaultBuilder([]).ConfigureApi((context, services, options) =>
            {
                OAuthToken oauthToken1 = new("token", timeout: TimeSpan.FromSeconds(1));
                options.AddTokens(oauthToken1);
            })
            .Build();

        private readonly IHost _hostUsingConfigureWithAClient =
            Host.CreateDefaultBuilder([]).ConfigureApi((context, services, options) =>
            {
                OAuthToken oauthToken = new("token", timeout: TimeSpan.FromSeconds(1));
                options.AddTokens(oauthToken);
                options.AddApiHttpClients(client => client.BaseAddress = new Uri(ClientUtils.BASE_ADDRESS));
            })
            .Build();

        private readonly IHost _hostUsingAddWithoutAClient =
            Host.CreateDefaultBuilder([]).ConfigureServices((host, services) =>
            {
                services.AddApi(options =>
                {
                    OAuthToken oauthToken1 = new("token", timeout: TimeSpan.FromSeconds(1));
                    options.AddTokens(oauthToken1);
                });
            })
            .Build();

        private readonly IHost _hostUsingAddWithAClient =
            Host.CreateDefaultBuilder([]).ConfigureServices((host, services) =>
            {
                services.AddApi(options =>
                {
                    OAuthToken oauthToken1 = new("token", timeout: TimeSpan.FromSeconds(1));
                    options.AddTokens(oauthToken1);
                    options.AddApiHttpClients(client => client.BaseAddress = new Uri(ClientUtils.BASE_ADDRESS));
                });
            })
            .Build();

        /// <summary>
        /// Test dependency injection when using the configure method
        /// </summary>
        [Fact]
        public void ConfigureApiWithAClientTest()
        {
            var abpApiDefinitionApi = _hostUsingConfigureWithAClient.Services.GetRequiredService<IAbpApiDefinitionApi>();
            Assert.True(abpApiDefinitionApi.HttpClient.BaseAddress != null);

            var abpApplicationLocalizationApi = _hostUsingConfigureWithAClient.Services.GetRequiredService<IAbpApplicationLocalizationApi>();
            Assert.True(abpApplicationLocalizationApi.HttpClient.BaseAddress != null);

            var abpTenantApi = _hostUsingConfigureWithAClient.Services.GetRequiredService<IAbpTenantApi>();
            Assert.True(abpTenantApi.HttpClient.BaseAddress != null);

            var applicationConnectionStringApi = _hostUsingConfigureWithAClient.Services.GetRequiredService<IApplicationConnectionStringApi>();
            Assert.True(applicationConnectionStringApi.HttpClient.BaseAddress != null);

            var applicationMenuItemApi = _hostUsingConfigureWithAClient.Services.GetRequiredService<IApplicationMenuItemApi>();
            Assert.True(applicationMenuItemApi.HttpClient.BaseAddress != null);

            var clientApplicationApi = _hostUsingConfigureWithAClient.Services.GetRequiredService<IClientApplicationApi>();
            Assert.True(clientApplicationApi.HttpClient.BaseAddress != null);

            var clientAutodetectApi = _hostUsingConfigureWithAClient.Services.GetRequiredService<IClientAutodetectApi>();
            Assert.True(clientAutodetectApi.HttpClient.BaseAddress != null);

            var customFeaturesApi = _hostUsingConfigureWithAClient.Services.GetRequiredService<ICustomFeaturesApi>();
            Assert.True(customFeaturesApi.HttpClient.BaseAddress != null);

            var customPermissionsApi = _hostUsingConfigureWithAClient.Services.GetRequiredService<ICustomPermissionsApi>();
            Assert.True(customPermissionsApi.HttpClient.BaseAddress != null);

            var eleoncoreApplicationConfigurationApi = _hostUsingConfigureWithAClient.Services.GetRequiredService<IEleoncoreApplicationConfigurationApi>();
            Assert.True(eleoncoreApplicationConfigurationApi.HttpClient.BaseAddress != null);

            var eventBusApi = _hostUsingConfigureWithAClient.Services.GetRequiredService<IEventBusApi>();
            Assert.True(eventBusApi.HttpClient.BaseAddress != null);

            var gatewayClientApi = _hostUsingConfigureWithAClient.Services.GetRequiredService<IGatewayClientApi>();
            Assert.True(gatewayClientApi.HttpClient.BaseAddress != null);

            var gatewayHttpForwardingApi = _hostUsingConfigureWithAClient.Services.GetRequiredService<IGatewayHttpForwardingApi>();
            Assert.True(gatewayHttpForwardingApi.HttpClient.BaseAddress != null);

            var gatewayManagementApi = _hostUsingConfigureWithAClient.Services.GetRequiredService<IGatewayManagementApi>();
            Assert.True(gatewayManagementApi.HttpClient.BaseAddress != null);

            var gatewayStaticKeyApi = _hostUsingConfigureWithAClient.Services.GetRequiredService<IGatewayStaticKeyApi>();
            Assert.True(gatewayStaticKeyApi.HttpClient.BaseAddress != null);

            var homeApi = _hostUsingConfigureWithAClient.Services.GetRequiredService<IHomeApi>();
            Assert.True(homeApi.HttpClient.BaseAddress != null);

            var microserviceApi = _hostUsingConfigureWithAClient.Services.GetRequiredService<IMicroserviceApi>();
            Assert.True(microserviceApi.HttpClient.BaseAddress != null);

            var resourceApi = _hostUsingConfigureWithAClient.Services.GetRequiredService<IResourceApi>();
            Assert.True(resourceApi.HttpClient.BaseAddress != null);

            var serversideAutodetectApi = _hostUsingConfigureWithAClient.Services.GetRequiredService<IServersideAutodetectApi>();
            Assert.True(serversideAutodetectApi.HttpClient.BaseAddress != null);

            var uiModuleApi = _hostUsingConfigureWithAClient.Services.GetRequiredService<IUiModuleApi>();
            Assert.True(uiModuleApi.HttpClient.BaseAddress != null);
        }

        /// <summary>
        /// Test dependency injection when using the configure method
        /// </summary>
        [Fact]
        public void ConfigureApiWithoutAClientTest()
        {
            var abpApiDefinitionApi = _hostUsingConfigureWithoutAClient.Services.GetRequiredService<IAbpApiDefinitionApi>();
            Assert.True(abpApiDefinitionApi.HttpClient.BaseAddress != null);

            var abpApplicationLocalizationApi = _hostUsingConfigureWithoutAClient.Services.GetRequiredService<IAbpApplicationLocalizationApi>();
            Assert.True(abpApplicationLocalizationApi.HttpClient.BaseAddress != null);

            var abpTenantApi = _hostUsingConfigureWithoutAClient.Services.GetRequiredService<IAbpTenantApi>();
            Assert.True(abpTenantApi.HttpClient.BaseAddress != null);

            var applicationConnectionStringApi = _hostUsingConfigureWithoutAClient.Services.GetRequiredService<IApplicationConnectionStringApi>();
            Assert.True(applicationConnectionStringApi.HttpClient.BaseAddress != null);

            var applicationMenuItemApi = _hostUsingConfigureWithoutAClient.Services.GetRequiredService<IApplicationMenuItemApi>();
            Assert.True(applicationMenuItemApi.HttpClient.BaseAddress != null);

            var clientApplicationApi = _hostUsingConfigureWithoutAClient.Services.GetRequiredService<IClientApplicationApi>();
            Assert.True(clientApplicationApi.HttpClient.BaseAddress != null);

            var clientAutodetectApi = _hostUsingConfigureWithoutAClient.Services.GetRequiredService<IClientAutodetectApi>();
            Assert.True(clientAutodetectApi.HttpClient.BaseAddress != null);

            var customFeaturesApi = _hostUsingConfigureWithoutAClient.Services.GetRequiredService<ICustomFeaturesApi>();
            Assert.True(customFeaturesApi.HttpClient.BaseAddress != null);

            var customPermissionsApi = _hostUsingConfigureWithoutAClient.Services.GetRequiredService<ICustomPermissionsApi>();
            Assert.True(customPermissionsApi.HttpClient.BaseAddress != null);

            var eleoncoreApplicationConfigurationApi = _hostUsingConfigureWithoutAClient.Services.GetRequiredService<IEleoncoreApplicationConfigurationApi>();
            Assert.True(eleoncoreApplicationConfigurationApi.HttpClient.BaseAddress != null);

            var eventBusApi = _hostUsingConfigureWithoutAClient.Services.GetRequiredService<IEventBusApi>();
            Assert.True(eventBusApi.HttpClient.BaseAddress != null);

            var gatewayClientApi = _hostUsingConfigureWithoutAClient.Services.GetRequiredService<IGatewayClientApi>();
            Assert.True(gatewayClientApi.HttpClient.BaseAddress != null);

            var gatewayHttpForwardingApi = _hostUsingConfigureWithoutAClient.Services.GetRequiredService<IGatewayHttpForwardingApi>();
            Assert.True(gatewayHttpForwardingApi.HttpClient.BaseAddress != null);

            var gatewayManagementApi = _hostUsingConfigureWithoutAClient.Services.GetRequiredService<IGatewayManagementApi>();
            Assert.True(gatewayManagementApi.HttpClient.BaseAddress != null);

            var gatewayStaticKeyApi = _hostUsingConfigureWithoutAClient.Services.GetRequiredService<IGatewayStaticKeyApi>();
            Assert.True(gatewayStaticKeyApi.HttpClient.BaseAddress != null);

            var homeApi = _hostUsingConfigureWithoutAClient.Services.GetRequiredService<IHomeApi>();
            Assert.True(homeApi.HttpClient.BaseAddress != null);

            var microserviceApi = _hostUsingConfigureWithoutAClient.Services.GetRequiredService<IMicroserviceApi>();
            Assert.True(microserviceApi.HttpClient.BaseAddress != null);

            var resourceApi = _hostUsingConfigureWithoutAClient.Services.GetRequiredService<IResourceApi>();
            Assert.True(resourceApi.HttpClient.BaseAddress != null);

            var serversideAutodetectApi = _hostUsingConfigureWithoutAClient.Services.GetRequiredService<IServersideAutodetectApi>();
            Assert.True(serversideAutodetectApi.HttpClient.BaseAddress != null);

            var uiModuleApi = _hostUsingConfigureWithoutAClient.Services.GetRequiredService<IUiModuleApi>();
            Assert.True(uiModuleApi.HttpClient.BaseAddress != null);
        }

        /// <summary>
        /// Test dependency injection when using the add method
        /// </summary>
        [Fact]
        public void AddApiWithAClientTest()
        {
            var abpApiDefinitionApi = _hostUsingAddWithAClient.Services.GetRequiredService<IAbpApiDefinitionApi>();
            Assert.True(abpApiDefinitionApi.HttpClient.BaseAddress != null);
            
            var abpApplicationLocalizationApi = _hostUsingAddWithAClient.Services.GetRequiredService<IAbpApplicationLocalizationApi>();
            Assert.True(abpApplicationLocalizationApi.HttpClient.BaseAddress != null);
            
            var abpTenantApi = _hostUsingAddWithAClient.Services.GetRequiredService<IAbpTenantApi>();
            Assert.True(abpTenantApi.HttpClient.BaseAddress != null);
            
            var applicationConnectionStringApi = _hostUsingAddWithAClient.Services.GetRequiredService<IApplicationConnectionStringApi>();
            Assert.True(applicationConnectionStringApi.HttpClient.BaseAddress != null);
            
            var applicationMenuItemApi = _hostUsingAddWithAClient.Services.GetRequiredService<IApplicationMenuItemApi>();
            Assert.True(applicationMenuItemApi.HttpClient.BaseAddress != null);
            
            var clientApplicationApi = _hostUsingAddWithAClient.Services.GetRequiredService<IClientApplicationApi>();
            Assert.True(clientApplicationApi.HttpClient.BaseAddress != null);
            
            var clientAutodetectApi = _hostUsingAddWithAClient.Services.GetRequiredService<IClientAutodetectApi>();
            Assert.True(clientAutodetectApi.HttpClient.BaseAddress != null);
            
            var customFeaturesApi = _hostUsingAddWithAClient.Services.GetRequiredService<ICustomFeaturesApi>();
            Assert.True(customFeaturesApi.HttpClient.BaseAddress != null);
            
            var customPermissionsApi = _hostUsingAddWithAClient.Services.GetRequiredService<ICustomPermissionsApi>();
            Assert.True(customPermissionsApi.HttpClient.BaseAddress != null);
            
            var eleoncoreApplicationConfigurationApi = _hostUsingAddWithAClient.Services.GetRequiredService<IEleoncoreApplicationConfigurationApi>();
            Assert.True(eleoncoreApplicationConfigurationApi.HttpClient.BaseAddress != null);
            
            var eventBusApi = _hostUsingAddWithAClient.Services.GetRequiredService<IEventBusApi>();
            Assert.True(eventBusApi.HttpClient.BaseAddress != null);
            
            var gatewayClientApi = _hostUsingAddWithAClient.Services.GetRequiredService<IGatewayClientApi>();
            Assert.True(gatewayClientApi.HttpClient.BaseAddress != null);
            
            var gatewayHttpForwardingApi = _hostUsingAddWithAClient.Services.GetRequiredService<IGatewayHttpForwardingApi>();
            Assert.True(gatewayHttpForwardingApi.HttpClient.BaseAddress != null);
            
            var gatewayManagementApi = _hostUsingAddWithAClient.Services.GetRequiredService<IGatewayManagementApi>();
            Assert.True(gatewayManagementApi.HttpClient.BaseAddress != null);
            
            var gatewayStaticKeyApi = _hostUsingAddWithAClient.Services.GetRequiredService<IGatewayStaticKeyApi>();
            Assert.True(gatewayStaticKeyApi.HttpClient.BaseAddress != null);
            
            var homeApi = _hostUsingAddWithAClient.Services.GetRequiredService<IHomeApi>();
            Assert.True(homeApi.HttpClient.BaseAddress != null);
            
            var microserviceApi = _hostUsingAddWithAClient.Services.GetRequiredService<IMicroserviceApi>();
            Assert.True(microserviceApi.HttpClient.BaseAddress != null);
            
            var resourceApi = _hostUsingAddWithAClient.Services.GetRequiredService<IResourceApi>();
            Assert.True(resourceApi.HttpClient.BaseAddress != null);
            
            var serversideAutodetectApi = _hostUsingAddWithAClient.Services.GetRequiredService<IServersideAutodetectApi>();
            Assert.True(serversideAutodetectApi.HttpClient.BaseAddress != null);
            
            var uiModuleApi = _hostUsingAddWithAClient.Services.GetRequiredService<IUiModuleApi>();
            Assert.True(uiModuleApi.HttpClient.BaseAddress != null);
        }

        /// <summary>
        /// Test dependency injection when using the add method
        /// </summary>
        [Fact]
        public void AddApiWithoutAClientTest()
        {
            var abpApiDefinitionApi = _hostUsingAddWithoutAClient.Services.GetRequiredService<IAbpApiDefinitionApi>();
            Assert.True(abpApiDefinitionApi.HttpClient.BaseAddress != null);

            var abpApplicationLocalizationApi = _hostUsingAddWithoutAClient.Services.GetRequiredService<IAbpApplicationLocalizationApi>();
            Assert.True(abpApplicationLocalizationApi.HttpClient.BaseAddress != null);

            var abpTenantApi = _hostUsingAddWithoutAClient.Services.GetRequiredService<IAbpTenantApi>();
            Assert.True(abpTenantApi.HttpClient.BaseAddress != null);

            var applicationConnectionStringApi = _hostUsingAddWithoutAClient.Services.GetRequiredService<IApplicationConnectionStringApi>();
            Assert.True(applicationConnectionStringApi.HttpClient.BaseAddress != null);

            var applicationMenuItemApi = _hostUsingAddWithoutAClient.Services.GetRequiredService<IApplicationMenuItemApi>();
            Assert.True(applicationMenuItemApi.HttpClient.BaseAddress != null);

            var clientApplicationApi = _hostUsingAddWithoutAClient.Services.GetRequiredService<IClientApplicationApi>();
            Assert.True(clientApplicationApi.HttpClient.BaseAddress != null);

            var clientAutodetectApi = _hostUsingAddWithoutAClient.Services.GetRequiredService<IClientAutodetectApi>();
            Assert.True(clientAutodetectApi.HttpClient.BaseAddress != null);

            var customFeaturesApi = _hostUsingAddWithoutAClient.Services.GetRequiredService<ICustomFeaturesApi>();
            Assert.True(customFeaturesApi.HttpClient.BaseAddress != null);

            var customPermissionsApi = _hostUsingAddWithoutAClient.Services.GetRequiredService<ICustomPermissionsApi>();
            Assert.True(customPermissionsApi.HttpClient.BaseAddress != null);

            var eleoncoreApplicationConfigurationApi = _hostUsingAddWithoutAClient.Services.GetRequiredService<IEleoncoreApplicationConfigurationApi>();
            Assert.True(eleoncoreApplicationConfigurationApi.HttpClient.BaseAddress != null);

            var eventBusApi = _hostUsingAddWithoutAClient.Services.GetRequiredService<IEventBusApi>();
            Assert.True(eventBusApi.HttpClient.BaseAddress != null);

            var gatewayClientApi = _hostUsingAddWithoutAClient.Services.GetRequiredService<IGatewayClientApi>();
            Assert.True(gatewayClientApi.HttpClient.BaseAddress != null);

            var gatewayHttpForwardingApi = _hostUsingAddWithoutAClient.Services.GetRequiredService<IGatewayHttpForwardingApi>();
            Assert.True(gatewayHttpForwardingApi.HttpClient.BaseAddress != null);

            var gatewayManagementApi = _hostUsingAddWithoutAClient.Services.GetRequiredService<IGatewayManagementApi>();
            Assert.True(gatewayManagementApi.HttpClient.BaseAddress != null);

            var gatewayStaticKeyApi = _hostUsingAddWithoutAClient.Services.GetRequiredService<IGatewayStaticKeyApi>();
            Assert.True(gatewayStaticKeyApi.HttpClient.BaseAddress != null);

            var homeApi = _hostUsingAddWithoutAClient.Services.GetRequiredService<IHomeApi>();
            Assert.True(homeApi.HttpClient.BaseAddress != null);

            var microserviceApi = _hostUsingAddWithoutAClient.Services.GetRequiredService<IMicroserviceApi>();
            Assert.True(microserviceApi.HttpClient.BaseAddress != null);

            var resourceApi = _hostUsingAddWithoutAClient.Services.GetRequiredService<IResourceApi>();
            Assert.True(resourceApi.HttpClient.BaseAddress != null);

            var serversideAutodetectApi = _hostUsingAddWithoutAClient.Services.GetRequiredService<IServersideAutodetectApi>();
            Assert.True(serversideAutodetectApi.HttpClient.BaseAddress != null);

            var uiModuleApi = _hostUsingAddWithoutAClient.Services.GetRequiredService<IUiModuleApi>();
            Assert.True(uiModuleApi.HttpClient.BaseAddress != null);
        }
    }
}
